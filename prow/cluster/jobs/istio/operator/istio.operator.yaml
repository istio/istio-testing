presubmits:

  istio/operator:

  - name: operator-lint
    branches:
      - ^master$
      - ^release-1.*$
    path_alias: istio.io/operator
    decorate: true
    always_run: true
    spec:
      containers:
      - image: gcr.io/istio-testing/build-tools:2019-08-21T08-35-40
        command:
        - make
        - lint
        env:
        - name: GO111MODULE
          value: "on"
      nodeSelector:
        testing: test-pool

  - name: operator-build
    branches:
      - ^master$
      - ^release-1.*$
    path_alias: istio.io/operator
    decorate: true
    always_run: true
    spec:
      containers:
      - image: gcr.io/istio-testing/build-tools:2019-08-21T08-35-40
        command:
        - make
        - mesh
        env:
        - name: GO111MODULE
          value: "on"
      nodeSelector:
        testing: build-pool

  - name: operator-test
    branches:
      - ^master$
      - ^release-1.*$
    path_alias: istio.io/operator
    decorate: true
    always_run: true
    spec:
      containers:
      - image: gcr.io/istio-testing/build-tools:2019-08-21T08-35-40
        command:
        - make
        - test
        env:
        - name: GO111MODULE
          value: "on"
      nodeSelector:
        testing: test-pool

  - name: operator-mandiff
    branches:
      - ^master$
      - ^release-1.*$
    path_alias: istio.io/operator
    decorate: true
    always_run: true
    spec:
      containers:
      - image: gcr.io/istio-testing/build-tools:2019-08-21T08-35-40
        command:
        - make
        - mandiff
        env:
        - name: GO111MODULE
          value: "on"
      nodeSelector:
        testing: test-pool

  - name: operator-manifest-apply
    branches:
      - ^master$
      - ^release-1.*$
    path_alias: istio.io/operator
    decorate: true
    always_run: true
    optional: true
    skip_report: true
    spec:
      containers:
        - image: gcr.io/istio-testing/istio-builder:v20190829-4edc0e70
          command:
            - entrypoint
            - prow/e2e_install.sh
          env:
            - name: GO111MODULE
              value: "on"
          securityContext:
            privileged: true
          resources:
            limits:
              cpu: "3"
              memory: 24Gi
            requests:
              cpu: 500m
              memory: 3Gi
          volumeMounts:
            - mountPath: /lib/modules
              name: modules
              readOnly: true
            - mountPath: /sys/fs/cgroup
              name: cgroup
      nodeSelector:
        testing: test-pool
      volumes:
        - hostPath:
            path: /lib/modules
            type: Directory
          name: modules
        - hostPath:
            path: /sys/fs/cgroup
            type: Directory
          name: cgroup
