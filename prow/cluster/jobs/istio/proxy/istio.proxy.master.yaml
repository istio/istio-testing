bazel_postsubmit_spec: &bazel_postsubmit_spec
  containers:
  - image: gcr.io/istio-testing/prowbazel:0.5.7
    resources:
      requests:
        memory: "8Gi"
        cpu: "8000m"
      limits:
        memory: "60Gi"
        cpu: "16000m"
  nodeSelector:
    testing: build-pool

bazel_spec: &bazel_spec
  containers:
  - image: gcr.io/istio-testing/prowbazel:0.5.7
    resources:
      requests:
        memory: "8Gi"
        cpu: "8000m"
      limits:
        memory: "60Gi"
        cpu: "16000m"
  nodeSelector:
    testing: build-pool

branch_spec: &branch_spec
- "^master$"

presubmits:

  istio/proxy:

  - name: proxy-presubmit
    context: prow/proxy-presubmit.sh
    branches: *branch_spec
    always_run: true
    decorate: true
    path_alias: istio.io/proxy
    timeout: 60m
    extra_refs:
    - org: istio
      repo: istio
      base_ref: master
      path_alias: istio.io/istio
    labels:
      preset-service-account: "true"
    spec: &bazel_spec 
      containers:
        - command:
          - ./prow/proxy-presubmit.sh

  - name: proxy-presubmit-asan
    context: prow/proxy-presubmit-asan.sh
    branches: *branch_spec
    always_run: true
    decorate: true
    path_alias: istio.io/proxy
    timeout: 60m
    extra_refs:
    - org: istio
      repo: istio
      base_ref: master
      path_alias: istio.io/istio
    labels:
      preset-service-account: "true"
    spec: &bazel_spec
      containers:
      - command:
        - ./prow/proxy-presubmit-asan.sh

  - name: proxy-presubmit-tsan
    context: prow/proxy-presubmit-tsan.sh
    branches: *branch_spec
    always_run: true
    decorate: true
    path_alias: istio.io/proxy
    timeout: 60m
    extra_refs:
    - org: istio
      repo: istio
      base_ref: master
      path_alias: istio.io/istio
    labels:
      preset-service-account: "true"
    spec: &bazel_spec
      containers:
      - command:
        - ./prow/proxy-presubmit-tsan.sh

postsubmits:

  istio/proxy:

  - name: proxy-postsubmit
    context: prow/proxy-postsubmit.sh
    branches: *branch_spec
    always_run: true
    decorate: true
    path_alias: istio.io/proxy
    timeout: 60m
    extra_refs:
    - org: istio
      repo: istio
      base_ref: master
      path_alias: istio.io/istio
    labels:
      preset-service-account: "true"
    spec: &bazel_postsubmit_spec
      containers:
      - command:
        - ./prow/proxy-postsubmit.sh
